<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Project Resetter</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --bg-primary: #0a0a0f;
        --bg-secondary: #111118;
        --bg-card: #1a1a24;
        --bg-accent: #242435;
        --text-primary: #ffffff;
        --text-secondary: #8b8ba3;
        --text-muted: #5a5a6b;
        --accent: #6366f1;
        --accent-hover: #4f46e5;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --border: #2d2d3d;
        --border-light: #404055;
        --glow: 0 0 20px rgba(99, 102, 241, 0.3);
        --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.5);
        --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.3);
        --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.4);
      }

      body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
        background-image: 
          radial-gradient(ellipse at top, rgba(99, 102, 241, 0.1) 0%, transparent 60%),
          radial-gradient(ellipse at bottom right, rgba(239, 68, 68, 0.08) 0%, transparent 60%);
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        padding: 2rem;
      }

      header {
        text-align: center;
        margin-bottom: 3rem;
      }

      .logo {
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(135deg, #6366f1, #8b5cf6, #06b6d4);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 0.5rem;
        letter-spacing: -0.02em;
      }

      .tagline {
        font-size: 1rem;
        color: var(--text-secondary);
        font-weight: 400;
      }

      .glass-card {
        background: rgba(26, 26, 36, 0.7);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 2rem;
        margin: 1.5rem 0;
        box-shadow: var(--shadow-lg);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .glass-card:hover {
        transform: translateY(-2px);
        border-color: var(--border-light);
        box-shadow: var(--shadow-lg), var(--glow);
      }

      .form-group {
        margin-bottom: 1.5rem;
      }

      .input-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .input-field {
        width: 100%;
        padding: 1rem 1.25rem;
        background: var(--bg-accent);
        border: 2px solid transparent;
        border-radius: 12px;
        color: var(--text-primary);
        font-size: 1rem;
        transition: all 0.3s ease;
        outline: none;
      }

      .input-field:focus {
        border-color: var(--accent);
        background: var(--bg-card);
        box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
      }

      .input-field::placeholder {
        color: var(--text-muted);
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        padding: 1rem 2rem;
        background: var(--accent);
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 0.875rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: relative;
        overflow: hidden;
      }

      .btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
      }

      .btn:hover::before {
        left: 100%;
      }

      .btn:hover {
        background: var(--accent-hover);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
      }

      .btn-danger {
        background: var(--danger);
      }

      .btn-danger:hover {
        background: #dc2626;
      }

      .projects-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
      }

      .projects-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
      }

      .stats {
        display: flex;
        gap: 1rem;
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      .project-grid {
        display: grid;
        gap: 1rem;
        list-style: none;
      }

      .project-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 16px;
        overflow: hidden;
        transition: all 0.3s ease;
        position: relative;
      }

      .project-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--success), var(--warning), var(--danger));
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .project-card:hover::before {
        opacity: 1;
      }

      .project-card:hover {
        transform: translateY(-1px);
        border-color: var(--border-light);
        box-shadow: var(--shadow-md);
      }

      .project-header {
        padding: 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        cursor: pointer;
        user-select: none;
      }

      .custom-checkbox {
        position: relative;
        width: 20px;
        height: 20px;
        flex-shrink: 0;
      }

      .custom-checkbox input {
        position: absolute;
        opacity: 0;
        width: 100%;
        height: 100%;
        margin: 0;
        cursor: pointer;
      }

      .custom-checkbox .checkmark {
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        height: 20px;
        background: var(--bg-accent);
        border: 2px solid var(--border-light);
        border-radius: 6px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .custom-checkbox input:checked + .checkmark {
        background: var(--accent);
        border-color: var(--accent);
        transform: scale(1.1);
      }

      .custom-checkbox input:indeterminate + .checkmark {
        background: var(--warning);
        border-color: var(--warning);
      }

      .custom-checkbox .checkmark::after {
        content: '';
        position: absolute;
        width: 6px;
        height: 10px;
        border: solid white;
        border-width: 0 2px 2px 0;
        transform: rotate(45deg) scale(0);
        transition: transform 0.2s ease;
      }

      .custom-checkbox input:checked + .checkmark::after {
        transform: rotate(45deg) scale(1);
      }

      .custom-checkbox input:indeterminate + .checkmark::after {
        width: 8px;
        height: 2px;
        border-width: 0 0 2px 0;
        transform: rotate(0deg) scale(1);
      }

      .project-info {
        flex: 1;
        min-width: 0;
      }

      .project-name {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
      }

      .project-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
        font-size: 0.875rem;
        color: var(--text-secondary);
      }

      .progress-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-shrink: 0;
      }

      .progress-bar {
        width: 60px;
        height: 8px;
        background: var(--bg-accent);
        border-radius: 4px;
        overflow: hidden;
        position: relative;
      }

      .progress-fill {
        height: 100%;
        border-radius: 4px;
        transition: all 0.5s ease;
        position: relative;
      }

      .progress-fill::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
      }

      .progress-text {
        font-size: 0.75rem;
        font-weight: 600;
        min-width: 35px;
        text-align: right;
      }

      .children-section {
        background: var(--bg-secondary);
        border-top: 1px solid var(--border);
      }

      .child-item {
        padding: 1rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
        border-bottom: 1px solid var(--border);
        transition: background-color 0.2s ease;
      }

      .child-item:last-child {
        border-bottom: none;
      }

      .child-item:hover {
        background: rgba(99, 102, 241, 0.05);
      }

      .child-checkbox {
        width: 16px;
        height: 16px;
      }

      .child-checkbox .checkmark {
        width: 16px;
        height: 16px;
        border-radius: 4px;
      }

      .child-checkbox input:checked + .checkmark {
        background: var(--success);
        border-color: var(--success);
      }

      .child-checkbox .checkmark::after {
        width: 4px;
        height: 8px;
      }

      .child-name {
        color: var(--text-secondary);
        font-size: 0.9rem;
        flex: 1;
      }

      .child-progress {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .child-progress-bar {
        width: 40px;
        height: 6px;
      }

      .child-progress-text {
        font-size: 0.7rem;
        min-width: 30px;
      }

      .no-projects {
        text-align: center;
        padding: 3rem;
        color: var(--text-muted);
      }

      .no-projects-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        opacity: 0.5;
      }

      .user-profile-card {
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.1));
        border: 1px solid rgba(99, 102, 241, 0.3);
      }

      .user-profile {
        display: flex;
        align-items: center;
        gap: 2rem;
      }

      .user-avatar {
        position: relative;
        flex-shrink: 0;
      }

      .avatar-image {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid var(--accent);
        box-shadow: var(--shadow-lg);
        transition: all 0.3s ease;
      }

      .avatar-image:hover {
        transform: scale(1.05);
        box-shadow: var(--shadow-lg), var(--glow);
      }

      .avatar-glow {
        position: absolute;
        top: -4px;
        left: -4px;
        right: -4px;
        bottom: -4px;
        border-radius: 50%;
        background: linear-gradient(45deg, var(--accent), var(--success), var(--warning));
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: -1;
        filter: blur(8px);
      }

      .user-avatar:hover .avatar-glow {
        opacity: 0.6;
      }

      .user-info {
        flex: 1;
        min-width: 0;
      }

      .user-name {
        font-size: 2rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
        background: linear-gradient(135deg, #6366f1, #8b5cf6);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .user-subtitle {
        color: var(--text-secondary);
        font-size: 1rem;
        margin-bottom: 1.5rem;
        opacity: 0.8;
      }

      .user-stats {
        display: flex;
        gap: 2rem;
      }

      .stat-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 1rem;
        background: rgba(99, 102, 241, 0.1);
        border-radius: 12px;
        border: 1px solid rgba(99, 102, 241, 0.2);
        transition: all 0.3s ease;
        min-width: 80px;
      }

      .stat-item:hover {
        background: rgba(99, 102, 241, 0.15);
        border-color: rgba(99, 102, 241, 0.4);
        transform: translateY(-2px);
      }

      .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--accent);
        margin-bottom: 0.25rem;
      }

      .stat-label {
        font-size: 0.75rem;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 600;
      }

      footer {
        text-align: center;
        margin-top: 3rem;
        padding: 2rem 0;
        border-top: 1px solid var(--border);
        color: var(--text-muted);
        font-size: 0.875rem;
      }

      @media (max-width: 768px) {
        .container {
          padding: 1rem;
        }

        .glass-card {
          padding: 1.5rem;
        }

        .user-profile {
          flex-direction: column;
          text-align: center;
          gap: 1.5rem;
        }

        .user-name {
          font-size: 1.75rem;
        }

        .user-stats {
          justify-content: center;
          gap: 1rem;
        }

        .stat-item {
          min-width: 70px;
          padding: 0.75rem;
        }

        .projects-header {
          flex-direction: column;
          gap: 1rem;
          align-items: flex-start;
        }

        .project-header {
          padding: 1rem;
        }

        .project-meta {
          flex-direction: column;
          align-items: flex-start;
          gap: 0.5rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="logo">Project Resetter</div>
        <div class="tagline">Advanced project configuration management</div>
      </header>

      <div class="glass-card">
        <form>
          <div class="form-group">
            <label class="input-label" for="login">Authentication</label>
            <input
              type="text"
              id="login"
              name="login"
              value="{{ login if login else '' }}"
              class="input-field"
              placeholder="Enter your credentials"
              required
            />
          </div>
          <button type="submit" class="btn">
            <span>Load Projects</span>
          </button>
        </form>
      </div>

      <!-- User Profile Section -->
      {% if user %}
      <div class="glass-card user-profile-card">
        <div class="user-profile">
          <div class="user-avatar">
            <img src="{{ user.user_image }}" alt="{{ user.name }}" class="avatar-image">
            <div class="avatar-glow"></div>
          </div>
          <div class="user-info">
            <h3 class="user-name">{{ user.name }}</h3> 
          </div>
        </div>
      </div>
      {% endif %}
      {% if projects %}

      <div class="glass-card">
        <div class="projects-header">
          <h2 class="projects-title">Project Selection</h2>
          <div class="stats">
            <span id="selected-count">0 selected</span>
            <span>{{ projects|length }} total</span>
          </div>
        </div>

        <form method="post" id="resetForm">
          <ul class="project-grid">
            {% for project in projects %}
            <li class="project-card">
              <div class="project-header" onclick="toggleProject('{{ project.link|replace("'", "\\'") }}')">
                <div class="custom-checkbox">
                  <input
                    type="checkbox"
                    id="{{ project.link }}"
                    name="projects"
                    value="{{ project.link }}"
                    onchange="handleProjectChange('{{ project.link|replace("'", "\\'") }}')"
                  />
                  <div class="checkmark"></div>
                </div>
                <div class="project-info">
                  <div class="project-name">{{ project.name }}</div>
                  <div class="project-meta">
                    <span>{{ project.children|length if project.children else 0 }} items</span>
                  </div>
                </div>
                <div class="progress-container">
                  <div class="progress-bar">
                    <div class="progress-fill" 
                         style="width: {{ project.mark or 0 }}%; 
                                background: {% if (project.mark or 0) >= 80 %}var(--success){% elif (project.mark or 0) >= 50 %}var(--warning){% else %}var(--danger){% endif %};">
                    </div>
                  </div>
                  <span class="progress-text" 
                        style="color: {% if (project.mark or 0) >= 80 %}var(--success){% elif (project.mark or 0) >= 50 %}var(--warning){% else %}var(--danger){% endif %};">
                    {{ project.mark or 0 }}%
                  </span>
                </div>
              </div>

              {% if project.children %}
              <div class="children-section" id="children-{{ project.name }}">
                {% for child in project.children %}
                <div class="child-item">
                  <div class="custom-checkbox child-checkbox">
                    <input
                      type="checkbox"
                      id="{{ child.link }}"
                      name="children"
                      value="{{ child.link }}"
                      class="child-input"
                      data-parent="{{ project.link }}"
                      onchange="handleChildChange('{{ project.link|replace("'", "\\'") }}')"
                    />
                    <div class="checkmark"></div>
                  </div>
                  <div class="child-name">{{ child.name }}</div>
                  <div class="child-progress">
                    <div class="progress-bar child-progress-bar">
                      <div class="progress-fill" 
                           style="width: {{ child.mark or 0 }}%; 
                                  background: {% if (child.mark or 0) >= 80 %}var(--success){% elif (child.mark or 0) >= 50 %}var(--warning){% else %}var(--danger){% endif %};">
                      </div>
                    </div>
                    <span class="child-progress-text progress-text" 
                          style="color: {% if (child.mark or 0) >= 80 %}var(--success){% elif (child.mark or 0) >= 50 %}var(--warning){% else %}var(--danger){% endif %};">
                      {{ child.mark or 0 }}%
                    </span>
                  </div>
                </div>
                {% endfor %}
              </div>
              {% endif %}
            </li>
            {% endfor %}
          </ul>

          <div style="margin-top: 2rem; text-align: center;">
            <button type="submit" class="btn btn-danger">
              <span>Reset Selected</span>
            </button>
          </div>
        </form>
      </div>
      {% else %}
      <div class="glass-card">
        <div class="no-projects">
          <div class="no-projects-icon">ðŸ“‹</div>
          <p>No projects available</p>
          <p style="font-size: 0.875rem; margin-top: 0.5rem;">Enter your credentials to load projects</p>
        </div>
      </div>
      {% endif %}

      <footer>
        <p>&copy; 2024 Project Resetter Pro. All rights reserved.</p>
      </footer>
    </div>

    <script>


    // Add this function to your existing JavaScript
      function checkProjectsByName(projectNames) {
        console.log('ðŸ” Looking for projects:', projectNames);

        let checkedCount = 0;

        // Find all project name elements
        const projectNameElements = document.querySelectorAll('.project-name');

        projectNameElements.forEach(function(element) {
          const projectName = element.textContent.trim();

          // Check if this project is in our target list
          projectNames.forEach(function(targetName) {
            if (projectName === targetName) {
              // Find the checkbox for this project
              const projectCard = element.closest('.project-card');
              const checkbox = projectCard.querySelector('input[type="checkbox"]');

              if (checkbox && !checkbox.checked) {
                // Check the checkbox
                checkbox.checked = true;
                checkbox.dispatchEvent(new Event('change', { bubbles: true }));

                // Also check the visual checkmark
                const checkmark = checkbox.nextElementSibling;
                if (checkmark && checkmark.classList.contains('checkmark')) {
                  checkmark.style.background = 'var(--accent)';
                  checkmark.style.borderColor = 'var(--accent)';
                }

                console.log('âœ… Checked:', projectName);
                checkedCount++;

                // Highlight the project card
                projectCard.style.backgroundColor = '#e8f5e8';
                projectCard.style.borderLeft = '4px solid #4CAF50';
              }
            }
          });
        });

        console.log('âœ… Checked ' + checkedCount + ' projects');
        if (typeof updateSelectedCount === "function") updateSelectedCount();
        return checkedCount;
      }

      // Also add this function for child projects
      function checkChildProjectsByName(childNames) {
        console.log('ðŸ” Looking for child projects:', childNames);

        let checkedCount = 0;

        // Find all child name elements
        const childNameElements = document.querySelectorAll('.child-name');

        childNameElements.forEach(function(element) {
          const childName = element.textContent.trim();

          // Check if this child is in our target list
          childNames.forEach(function(targetName) {
            if (childName === targetName) {
              // Find the checkbox for this child
              const childItem = element.closest('.child-item');
              const checkbox = childItem.querySelector('input[type="checkbox"]');

              if (checkbox && !checkbox.checked) {
                // Check the checkbox
                checkbox.checked = true;
                checkbox.dispatchEvent(new Event('change', { bubbles: true }));

                // Also check the visual checkmark
                const checkmark = checkbox.nextElementSibling;
                if (checkmark && checkmark.classList.contains('checkmark')) {
                  checkmark.style.background = 'var(--success)';
                  checkmark.style.borderColor = 'var(--success)';
                }

                console.log('âœ… Checked child:', childName);
                checkedCount++;

                // Highlight the child item
                childItem.style.backgroundColor = '#e8f5e8';
              }

              // Update the parent checkbox state
              const parentCheckboxId = checkbox.getAttribute('data-parent');
              if (parentCheckboxId) {
                const parentCheckbox = document.getElementById(parentCheckboxId);
                if (parentCheckbox && typeof handleChildChange === "function") {
                  handleChildChange(parentCheckboxId);
                }
              }
            }
          });
        });

        console.log('âœ… Checked ' + checkedCount + ' child projects');
        if (typeof updateSelectedCount === "function") updateSelectedCount();
        return checkedCount;
      }

      // Combined function to check both parent and child projects
      function autoCheckProjects(projectNames) {
        var parents = [];
        var children = [];

        // Separate parent and child projects
        projectNames.forEach(function(name) {
          if (name.includes(' #') || /#\d+$/.test(name)) {
            children.push(name);
          } else {
            parents.push(name);
          }
        });

        console.log('ðŸ‘¨â€ðŸ‘¦ Separated projects - Parents:', parents, 'Children:', children);

        // Check parent projects
        var parentCount = checkProjectsByName(parents);

        // Check child projects after a short delay
        setTimeout(function() {
          var childCount = checkChildProjectsByName(children);
          console.log('ðŸŽ¯ Total checked: ' + (parentCount + childCount) + ' projects');
        }, 500);

        return parentCount;
      }

      // Auto-run function that can be called from URL parameters
      function autoRunFromUrl() {
        var urlParams = new URLSearchParams(window.location.search);
        var projectsParam = urlParams.get('projects');

        if (projectsParam) {
          var projects = projectsParam.split(',').map(function(p) {
            return decodeURIComponent(p).replace(/\+/g, ' ');
          });

          console.log('ðŸ¤– Auto-checking projects from URL:', projects);

          // Wait for page to fully load
          setTimeout(function() {
            autoCheckProjects(projects);

            // Optional: Auto-submit after checking
            var shouldSubmit = urlParams.get('submit') === 'true';
            if (shouldSubmit) {
              setTimeout(function() {
                var btn = document.querySelector('button[type="submit"]');
                if (btn) btn.click();
                console.log('ðŸš€ Auto-submitting form...');
              }, 2000);
            }
          }, 1000);
        }
      }

      // Add this to your existing DOMContentLoaded event listener
      document.addEventListener('DOMContentLoaded', function() {
        // Your existing code...

        // Add auto-run functionality
        autoRunFromUrl();

        // Also make the function available globally for manual testing
        window.autoCheckProjects = autoCheckProjects;
        window.checkProjectsByName = checkProjectsByName;
        window.checkChildProjectsByName = checkChildProjectsByName;
      });

      function sanitizeId(name) {
        return name.replace(/[^a-zA-Z0-9\-_]/g, '-');
      }

      function toggleProject(projectName) {
        const checkbox = document.getElementById(projectName);
        if (checkbox && event.target.tagName !== 'INPUT') {
          checkbox.checked = !checkbox.checked;
          handleProjectChange(projectName);
        }
      }

      function handleProjectChange(projectName) {
        const parentCheckbox = document.getElementById(projectName);
        const childCheckboxes = document.querySelectorAll(`input[data-parent="${projectName}"]`);
        
        if (parentCheckbox && childCheckboxes.length > 0) {
          childCheckboxes.forEach(child => {
            child.checked = parentCheckbox.checked;
          });
          // Clear indeterminate state when parent is clicked
          parentCheckbox.indeterminate = false;
        }
        
        updateSelectedCount();
      }

      function handleChildChange(projectName) {
        const parentCheckbox = document.getElementById(projectName);
        const childCheckboxes = document.querySelectorAll(`input[data-parent="${projectName}"]`);
        
        if (parentCheckbox && childCheckboxes.length > 0) {
          const checkedChildren = Array.from(childCheckboxes).filter(cb => cb.checked);
          
          if (checkedChildren.length === 0) {
            // No children selected
            parentCheckbox.checked = false;
            parentCheckbox.indeterminate = false;
          } else if (checkedChildren.length === childCheckboxes.length) {
            // All children selected
            parentCheckbox.checked = true;
            parentCheckbox.indeterminate = false;
          } else {
            // Some children selected
            parentCheckbox.checked = false;
            parentCheckbox.indeterminate = true;
          }
        }
        
        updateSelectedCount();
      }

      function updateSelectedCount() {
        const allCheckboxes = document.querySelectorAll('input[type="checkbox"]:checked');
        const selectedCount = allCheckboxes.length;
        const countElement = document.getElementById('selected-count');
        if (countElement) {
          countElement.textContent = `${selectedCount} selected`;
        }
      }

      // Smooth entrance animations
      document.addEventListener('DOMContentLoaded', function() {
        const cards = document.querySelectorAll('.glass-card, .project-card');
        cards.forEach((card, index) => {
          card.style.opacity = '0';
          card.style.transform = 'translateY(20px)';
          setTimeout(() => {
            card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
          }, index * 100);
        });
        
        updateSelectedCount();

        // Add event listeners to prevent click propagation on checkboxes
        document.querySelectorAll('.custom-checkbox input').forEach(checkbox => {
          checkbox.addEventListener('click', function(e) {
            e.stopPropagation();
          });
        });

        // Add event listeners to child items to prevent parent toggle
        document.querySelectorAll('.child-item').forEach(childItem => {
          childItem.addEventListener('click', function(e) {
            e.stopPropagation();
            const checkbox = this.querySelector('input[type="checkbox"]');
            if (checkbox && e.target !== checkbox) {
              checkbox.checked = !checkbox.checked;
              checkbox.dispatchEvent(new Event('change'));
            }
          });
        });
      });

      // Form submission with loading state
      document.getElementById('resetForm')?.addEventListener('submit', async function(e) {
        e.preventDefault();
        const submitBtn = this.querySelector('button[type="submit"]');
        const originalText = submitBtn.innerHTML;
        submitBtn.innerHTML = '<span>Processing...</span>';
        submitBtn.disabled = true;

        try {
          // Get all checked checkboxes
          const checkedProjects = document.querySelectorAll('input[name="projects"]:checked');
          const checkedChildren = document.querySelectorAll('input[name="children"]:checked');
          
          // Create form data
          const formData = new FormData();
          
          // Add project links
          checkedProjects.forEach(checkbox => {
            formData.append('projects', checkbox.value);
          });
          
          // Add children links
          checkedChildren.forEach(checkbox => {
            formData.append('children', checkbox.value);
          });
          
          // Submit to backend
          const response = await fetch('/reset', {
            method: 'POST',
            body: formData
          });
          
          if (response.ok) {
            const result = await response.json();
            // Show success message with details
            alert(`Projects reset completed!\nSuccessful: ${result.success_count}\nFailed: ${result.error_count}`);
            
            // Optionally reload the page to refresh the project list
            if (result.success_count > 0) {
              const reload = confirm('Reset completed. Would you like to reload the page to see updated results?');
              if (reload) {
                window.location.reload();
              }
            }
          } else {
            const errorText = await response.text();
            alert(`Error resetting projects: ${errorText}`);
          }
        } catch (error) {
          console.error('Error:', error);
          alert('Error resetting projects. Please try again.');
        } finally {
          // Restore button state
          submitBtn.innerHTML = originalText;
          submitBtn.disabled = false;
        }
      });

    </script>
    <script>
      // ... your existing JavaScript functions ...
    
      {% if failed_projects %}
      // Debug version to see exactly what's happening
      document.addEventListener('DOMContentLoaded', function() {
        console.log('=== AUTO-CHECK DEBUG ===');
        console.log('Failed projects from server:', {{ failed_projects | tojson }});
        
        // Log current state of the page
        setTimeout(function() {
          const projectNames = document.querySelectorAll('.project-name');
          const checkboxes = document.querySelectorAll('input[type="checkbox"]');
          
          console.log('Project name elements found:', projectNames.length);
          console.log('Checkboxes found:', checkboxes.length);
          
          projectNames.forEach((el, index) => {
            console.log(`Project ${index + 1}:`, el.textContent.trim());
          });
          
          // Now try to auto-check
          if (projectNames.length > 0) {
            console.log('Attempting auto-check...');
            autoCheckProjects({{ failed_projects | tojson }});
          } else {
            console.log('No projects found yet, retrying in 1 second...');
            setTimeout(function() {
              autoCheckProjects({{ failed_projects | tojson }});
            }, 1000);
          }
        }, 500);
      });
      {% endif %}
    </script>
  </body>
</html>